<!DOCTYPE html>
<html>
  <head>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type" />
    <title>random</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/synaptic/1.1.4/synaptic.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  </head>
  <body id="body">
    <style>
      #n {
        font-size: 40vw;
        margin: 0;
        padding: 0;
      }
      .n {
        color: white;
        text-align: center;
        vertical-align: middle;
      }
    </style>
    <div class="n"><p id="n"></p></div>
    <script>
      var min = 0;
      var max = 101;
      document.getElementById("n").innerHTML =
        Math.floor(Math.random() * (+max - +min)) + +min;

      var hexDigits = new Array(
        "0",
        "1",
        "2",
        "3",
        "4",
        "5",
        "6",
        "7",
        "8",
        "9",
        "a",
        "b",
        "c",
        "d",
        "e",
        "f"
      );

      function rgb2hex(rgb) {
        rgb = rgb.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+).*\)$/);
        return "#" + hex(rgb[1]) + hex(rgb[2]) + hex(rgb[3]);
      }

      function hex(x) {
        return isNaN(x)
          ? "00"
          : hexDigits[(x - (x % 16)) / 16] + hexDigits[x % 16];
      }

      function hexFromInts(r, g, b) {
        return "#" + hex(r) + hex(g) + hex(b);
      }

      function intsFromHex(hex) {
        return [
          parseInt(hex[1] + hex[2], 16),
          parseInt(hex[3] + hex[4], 16),
          parseInt(hex[5] + hex[6], 16)
        ];
      }

      class Color {
        constructor(red, green, blue) {
          this.red = Math.floor(red);
          this.green = Math.floor(green);
          this.blue = Math.floor(blue);
        }

        toRgbInts() {
          return [this.red, this.green, this.blue];
        }

        toHex() {
          return hexFromInts(...this.toRgbInts());
        }

        toNeural() {
          return [this.red / 255, this.green / 255, this.blue / 255];
        }

        static fromRgbInts(r, g, b) {
          return new Color(r, g, b);
        }

        static fromRgbString(str) {
          return Color.fromHex(rgb2hex(str));
        }

        static fromHex(hex) {
          return new Color(...intsFromHex(hex));
        }

        static fromNeural(r, g, b) {
          let red = Math.round(r * 255);
          let green = Math.round(g * 255);
          let blue = Math.round(b * 255);

          return new Color(red, green, blue);
        }

        static newRandom() {
          return Color.fromRgbInts(
            Math.floor(Math.random() * 256),
            Math.floor(Math.random() * 256),
            Math.floor(Math.random() * 256)
          );
        }
      }

      const Trainer = synaptic.Trainer;
      const Architect = synaptic.Architect;

      const generatorNetwork = new Architect.Perceptron(3, 27, 3);
      const generatorNetworkTrainer = new Trainer(generatorNetwork);

      function regenerateColors(event = null) {
        let bgcolor = Color.newRandom();
        let fgcolor = generateForegroundColor(bgcolor);

        $("#body").css({
          "background-color": bgcolor.toHex(),
          color: fgcolor.toHex()
        });
      }

      function trainOnCurrentColors() {
        let bgcolor = Color.fromRgbString($("#body").css("background-color"));
        let fgcolor = Color.fromRgbString($("#body").css("color"));

        generatorNetworkTrainer.train([
          {
            input: bgcolor.toNeural(),
            output: fgcolor.toNeural()
          }
        ]);
      }

      function generateForegroundColor(bgcolor) {
        let input = bgcolor.toNeural();
        let output = generatorNetwork.activate(input);

        return Color.fromNeural(...output);
      }

      function initPage() {
        $("#next").on("click", function(event) {
          trainOnCurrentColors();
          regenerateColors();
          event.preventDefault();
        });

        generatorNetworkTrainer.train([
          { input: [0, 0, 0], output: [1, 1, 1] },
          { input: [1, 1, 1], output: [0, 0, 0] }
        ]);

        regenerateColors();
      }

      $(initPage);
    </script>
  </body>
</html>
